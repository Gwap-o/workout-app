# Kinobody Greek God 2.0 Workout Tracker

## Project Overview

This is a **100% free** full-stack workout tracking application specifically designed for the Kinobody Greek God 2.0 program. The app provides intelligent workout progression tracking, multi-device sync, nutrition planning, and comprehensive progress analytics—all while remaining completely free using Netlify and Supabase free tiers.

**Key Value Proposition:** Track workouts with automatic progression calculations, methodology enforcement guardrails, and complete cloud backup across all devices at zero cost.

---

## Technology Stack

### Frontend
- **Framework:** React 18+ with TypeScript
- **Build Tool:** Vite
- **Styling:** Tailwind CSS + shadcn/ui components
- **Routing:** React Router v6
- **Charts:** Recharts
- **Date Utilities:** date-fns

### Backend & Services
- **Database:** Supabase (PostgreSQL with Row Level Security)
- **Storage:** Supabase Storage (for progress photos)
- **Authentication:** Netlify Identity (generates JWT tokens for Supabase RLS)
- **Hosting:** Netlify (free tier with auto-deploy)

### Total Monthly Cost
**$0** - All services on free tiers

---

## IMPORTANT: Supabase Development Guidelines

### ALWAYS Use Supabase MCP Server

**When working with Supabase (database queries, migrations, schema changes, data operations), you MUST use the Supabase MCP server tools instead of writing manual SQL or using the Supabase client directly.**

#### Why Use Supabase MCP:
- Direct integration with your Supabase project
- Automatic migration tracking and versioning
- Built-in error handling and validation
- Safer schema modifications
- Better visibility into database operations
- Proper migration history

#### Available MCP Tools:
- `mcp__supabase__list_tables` - List all database tables
- `mcp__supabase__execute_sql` - Execute SQL queries (for data operations)
- `mcp__supabase__apply_migration` - Apply DDL migrations (schema changes)
- `mcp__supabase__list_migrations` - View migration history
- `mcp__supabase__get_project` - Get project details
- `mcp__supabase__list_extensions` - List database extensions
- And many more (check MCP documentation)

#### When to Use Each Tool:
- **Schema Changes (DDL):** Use `apply_migration` - creates versioned migrations
- **Data Queries (DML):** Use `execute_sql` for SELECT, INSERT, UPDATE, DELETE
- **Exploration:** Use `list_tables`, `list_extensions` to understand database structure

#### Example Workflow:
```
User: "Add a new column to track workout intensity"

CORRECT Approach:
1. Use mcp__supabase__apply_migration to create migration
2. Name: "add_workout_intensity_column"
3. Query: ALTER TABLE workout_sessions ADD COLUMN intensity INTEGER;

INCORRECT Approach:
❌ Writing SQL in a .sql file manually
❌ Using Supabase client to execute ALTER TABLE
❌ Suggesting user runs SQL in Supabase dashboard
```

---

## Environment Variables

### API Keys Setup (CRITICAL - BREAKING CHANGE)

**Reference:** https://github.com/orgs/supabase/discussions/29260

**⚠️ IMPORTANT: Anon keys are being DEPRECATED - Use Publishable Keys**

**Correct Key Types:**

- **Publishable Key (REQUIRED):** The modern, secure approach
  - Format: `sb_publishable_...`
  - Safe for client-side use, works with RLS
  - Can be rotated independently
  - Found in: Supabase Dashboard → Project Settings → API → "Publishable" section

- **Anon Key (DEPRECATED):** Legacy JWT-based key
  - Format: `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...`
  - Still works but will be phased out
  - DO NOT use for new projects

- **Service Role Key (NEVER use client-side):**
  - Bypasses RLS entirely
  - Server-side only, extremely sensitive
  - Would expose full database access if leaked

**Why Publishable Keys are Better:**
1. Independent rotation (doesn't affect service_role key)
2. More secure authentication architecture
3. Better key management and security practices
4. Future-proof as anon keys are deprecated

### Required Variables

```bash
# .env.local (development)
VITE_SUPABASE_URL=https://your-project-id.supabase.co
VITE_SUPABASE_PUBLISHABLE_KEY=sb_publishable_your_key_here
```

**Production:** Add same variables to Netlify Dashboard → Site Settings → Environment Variables

### Getting Your Keys
1. Go to Supabase Dashboard
2. Select your project
3. Navigate to: **Project Settings → API**
4. Copy:
   - Project URL → `VITE_SUPABASE_URL`
   - **Publishable key** (NOT anon key) → `VITE_SUPABASE_PUBLISHABLE_KEY`
     - Look for the key starting with `sb_publishable_...`

---

## Database Schema

### Core Tables

1. **user_profiles** - User stats, current phase, nutrition targets
   - `user_id` (FK to Netlify Identity)
   - `current_phase`, `current_week`, `bodyweight`, `height`
   - `calories_training`, `calories_rest`, `protein`, `fat`, `carbs`

2. **workout_sessions** - Individual workout records
   - `user_id`, `date`, `workout_type` (A/B), `phase`, `duration`
   - Tracks completed workouts with timestamp

3. **exercise_logs** - Sets, reps, weight per exercise
   - `user_id`, `session_id`, `exercise_name`, `sets` (JSONB)
   - Each set: `{ reps, weight, isFailure, restSeconds }`

4. **bodyweight_logs** - Weight tracking over time
   - `user_id`, `date`, `weight`, `notes`

5. **meal_plans** - Nutrition meal templates
   - `user_id`, `meal_type`, `foods` (JSONB), `total_calories`, `macros`

6. **progress_photos** - Photo metadata
   - `user_id`, `date`, `storage_path`, `phase`, `week`
   - Actual images stored in Supabase Storage

7. **user_settings** - App preferences (JSONB)
   - Theme, units (lbs/kg), notifications, etc.

### Security: Row Level Security (RLS)

**All tables have RLS enabled with policies:**
```sql
-- Example policy (applied to all tables)
CREATE POLICY "Users can view own data"
ON table_name FOR SELECT
USING (auth.jwt() ->> 'sub' = user_id);
```

**This ensures:**
- Users only see their own data
- JWT from Netlify Identity validates access
- No manual user_id filtering needed in queries

---

## Authentication Flow

### Netlify Identity → Supabase Integration

```
User Login → Netlify Identity → JWT Token → localStorage
                                     ↓
                  Supabase Client (with JWT in headers)
                                     ↓
                          PostgreSQL with RLS validation
```

### Implementation Pattern

```typescript
// src/lib/supabase/client.ts
import { createClient } from '@supabase/supabase-js';
import netlifyIdentity from 'netlify-identity-widget';

export const supabase = createClient(
  import.meta.env.VITE_SUPABASE_URL,
  import.meta.env.VITE_SUPABASE_PUBLISHABLE_KEY, // Use publishable key, NOT anon key
  {
    global: {
      headers: async () => {
        const user = netlifyIdentity.currentUser();
        if (user?.token?.access_token) {
          return { Authorization: `Bearer ${user.token.access_token}` };
        }
        return {};
      },
    },
  }
);
```

**Why Netlify Identity (not Supabase Auth)?**
- Seamless integration with Netlify hosting
- No custom auth code needed
- Free tier: 1,000 active users/month
- Generates JWT compatible with Supabase RLS

---

## Core Features & Business Logic

### 1. Workout Tracking
- **A/B Split System:** Alternating workouts (e.g., Workout A on Mon, Workout B on Thu)
- **3 Phases:** 8 weeks each, automatic exercise rotation on phase change
- **Training Methods:**
  - **RPT (Reverse Pyramid Training):** Top set max effort, -10% weight each subsequent set
  - **Kino Rep Method:** Same weight, decreasing reps
  - **Rest-Pause:** Single set to failure, 3 mini-sets with 15s rest
  - **Standard Sets:** Traditional 3x8 style
  - **MEGA Training:** 12-week progressive overload specialization

### 2. Double Progression System
```
IF current_reps >= top_of_range THEN
  next_weight = current_weight + 5 lbs (upper) or 10 lbs (lower)
  next_reps = bottom_of_range
ELSE
  next_weight = current_weight
  next_reps = current_reps + 1
END
```

**Example:**
- Target: 6-8 reps
- Week 1: 135 lbs × 6 reps → Stay at 135 lbs, aim for 7 reps
- Week 2: 135 lbs × 8 reps → Increase to 140 lbs, reset to 6 reps

### 3. Methodology Guardrails (Critical)

**These rules MUST be enforced to prevent overtraining:**

- ✅ Max 3 workouts per week
- ✅ No consecutive day training (minimum 48-hour rest for CNS recovery)
- ✅ Training methods are locked per exercise (can't change RPT to Kino Rep mid-phase)
- ✅ Phase changes only allowed every 8 weeks
- ✅ MEGA training limited to 12 weeks maximum
- ✅ Plateau detection: Flags if no progress for 2+ consecutive workouts

**Implementation:** Check workout history before allowing new session

### 4. Nutrition Calculator
- **One-time setup:** User enters bodyweight, goal (cut/maintain/bulk)
- **Auto-calculates:**
  - Maintenance calories
  - Training day calories (+10-20% on workout days)
  - Rest day calories (-10-20% on off days)
  - Macro breakdown (protein: 1g/lb, fat: 0.3-0.4g/lb, carbs: remainder)
- **No daily tracking:** Uses meal plan templates

### 5. Progress Analytics
- **Line Charts:** Exercise progression over time (weight × reps)
- **Fitness Standards:** Good/Great/Godlike tiers per exercise
- **Calendar Heatmap:** Workout consistency visualization
- **Streak Counter:** Consecutive weeks with 3 workouts
- **Body Measurements:** Chest, arms, waist, etc.

---

## Project Structure

```
workout-app/
├── docs/                          # Comprehensive documentation
│   ├── PROJECT_OVERVIEW.md       # This summary
│   ├── TECH_STACK.md             # Technology decisions
│   ├── DATA_MODELS.md            # Full database schema
│   ├── FEATURES.md               # Feature specifications
│   └── ROADMAP.md                # 4-week implementation plan
├── src/
│   ├── lib/
│   │   ├── supabase/             # Database operations (CRUD)
│   │   ├── netlify/              # Auth helpers
│   │   ├── hooks/                # Custom React hooks
│   │   ├── utils/                # Helper functions
│   │   └── constants/            # Program data (exercises, phases)
│   ├── components/
│   │   ├── ui/                   # shadcn/ui components
│   │   ├── auth/                 # Login/Signup
│   │   ├── workout/              # Workout tracking UI
│   │   ├── nutrition/            # Meal planning
│   │   ├── charts/               # Progress visualizations
│   │   └── layout/               # App shell
│   ├── pages/                    # Route components
│   ├── contexts/                 # React contexts (Auth, Workout)
│   ├── types/                    # TypeScript interfaces
│   ├── App.tsx
│   └── main.tsx
├── .env.local                    # Environment variables (NOT in Git)
├── .env.local.example            # Template for .env.local
├── netlify.toml                  # Netlify configuration
├── package.json
└── vite.config.ts
```

---

## Development Workflow

### Starting Development
```bash
npm install
npm run dev
```

### Before First Run
1. Create Supabase project
2. Copy URL + anon key to `.env.local`
3. Run database migrations (use Supabase MCP)
4. Enable RLS on all tables
5. Create storage bucket: `progress-photos`

### Database Changes
**ALWAYS use Supabase MCP for migrations:**
```bash
# Use mcp__supabase__apply_migration
# Name: descriptive_snake_case
# Query: Your DDL (CREATE, ALTER, DROP, etc.)
```

### Deployment
```bash
# Push to GitHub
git push origin main

# Netlify auto-deploys from main branch
# Add environment variables in Netlify dashboard
# Enable Netlify Identity in Site Settings
```

---

## Key Implementation Notes

### Data Fetching Pattern
```typescript
// Custom hook example
const useWorkoutHistory = (userId: string) => {
  const [workouts, setWorkouts] = useState([]);

  useEffect(() => {
    const fetchWorkouts = async () => {
      const { data, error } = await supabase
        .from('workout_sessions')
        .select('*, exercise_logs(*)')
        .order('date', { ascending: false })
        .limit(10);

      // No need to filter by userId - RLS handles it automatically
      if (data) setWorkouts(data);
    };

    fetchWorkouts();
  }, [userId]);

  return workouts;
};
```

### Progression Calculation
```typescript
// Double progression logic
const calculateNextWeight = (
  currentWeight: number,
  currentReps: number,
  targetReps: { min: number; max: number },
  exerciseType: 'upper' | 'lower'
): number => {
  if (currentReps >= targetReps.max) {
    const increment = exerciseType === 'upper' ? 5 : 10;
    return currentWeight + increment;
  }
  return currentWeight; // Same weight, aim for more reps
};
```

### Plateau Detection
```typescript
const detectPlateau = (recentSessions: WorkoutSession[]): boolean => {
  // Flag if last 2+ workouts show no improvement
  const lastTwo = recentSessions.slice(0, 2);
  return lastTwo.every((session, i) => {
    if (i === 0) return false; // Can't compare first
    const previous = lastTwo[i - 1];
    return session.total_volume <= previous.total_volume;
  });
};
```

---

## Testing Checklist

### Authentication
- [ ] User can sign up with email
- [ ] User can log in
- [ ] JWT token stored in localStorage
- [ ] Token sent with Supabase requests
- [ ] RLS correctly isolates user data

### Workout Tracking
- [ ] Can log new workout
- [ ] RPT calculations correct (-10% weight per set)
- [ ] Progression logic works (double progression)
- [ ] Guardrails prevent consecutive day training
- [ ] Plateau detection flags stagnant exercises

### Multi-Device Sync
- [ ] Data syncs across devices automatically
- [ ] No manual refresh needed
- [ ] Real-time updates (optional with Realtime)

### Nutrition
- [ ] Calculator shows correct macros
- [ ] Training vs rest day targets differ
- [ ] Meal plans save and load correctly

### Progress Analytics
- [ ] Charts render with correct data
- [ ] Fitness standards display proper tiers
- [ ] Calendar heatmap shows workout days
- [ ] Progress photos upload to storage

---

## Common Tasks & Commands

### Install Dependencies
```bash
npm install @supabase/supabase-js netlify-identity-widget
npm install react-router-dom date-fns recharts lucide-react
npm install -D tailwindcss postcss autoprefixer
npx shadcn-ui@latest init
```

### Add shadcn/ui Components
```bash
npx shadcn-ui@latest add button card input select table tabs toast dialog calendar
```

### Database Operations (Use Supabase MCP)
```bash
# List all tables
mcp__supabase__list_tables

# Apply migration
mcp__supabase__apply_migration
  name: "create_user_profiles_table"
  query: "CREATE TABLE user_profiles (...)"
```

---

## Troubleshooting

### RLS Policy Errors
**Symptom:** `new row violates row-level security policy`

**Solution:**
1. Verify JWT token in request headers
2. Check Netlify Identity user is logged in
3. Ensure `user_id` matches JWT `sub` claim
4. Confirm RLS policies exist on table

### Environment Variables Not Loading
**Symptom:** `undefined` for `import.meta.env.VITE_SUPABASE_URL`

**Solution:**
1. Ensure `.env.local` exists in project root
2. Variables must start with `VITE_` prefix
3. Restart dev server after changing `.env.local`
4. For production, add to Netlify environment variables

### Netlify Identity Not Initializing
**Symptom:** `netlifyIdentity is not defined`

**Solution:**
1. Enable Identity in Netlify dashboard
2. Import widget: `import netlifyIdentity from 'netlify-identity-widget'`
3. Initialize on app mount: `netlifyIdentity.init()`
4. Check site URL matches Netlify deployment

---

## Resources & References

### Documentation
- [Supabase Docs](https://supabase.com/docs)
- [Netlify Identity Docs](https://docs.netlify.com/visitor-access/identity/)
- [React Router v6](https://reactrouter.com/)
- [shadcn/ui](https://ui.shadcn.com/)

### Key Articles
- [Supabase API Keys Guide](https://github.com/orgs/supabase/discussions/29260) - Anon vs Service Role keys
- [RLS Policies Explained](https://supabase.com/docs/guides/auth/row-level-security)
- [Netlify Identity + Supabase Integration](https://supabase.com/docs/guides/auth/third-party-auth/netlify)

### Program Methodology
- Kinobody Greek God 2.0 Program (proprietary)
- Double progression system
- RPT training method
- Fitness standards (Good/Great/Godlike)

---

## Project Goals

1. **Zero Cost:** Maintain 100% free operation using free tiers
2. **Multi-Device Sync:** Seamless data sync across all devices
3. **Methodology Enforcement:** Prevent overtraining with guardrails
4. **Intelligent Progression:** Automatic weight/rep calculations
5. **Complete Tracking:** Workouts, nutrition, body measurements, photos
6. **User-Friendly:** Minimal input required, maximum value delivered

---

## Development Principles

### When Building Features:
1. **Data First:** Design database schema before UI
2. **RLS Always:** Every table must have RLS policies
3. **Mobile Responsive:** Design for mobile-first
4. **Offline Support:** Consider future PWA capabilities
5. **Performance:** Optimize queries, use indexes
6. **User Experience:** Minimize clicks, maximize automation

### Code Quality:
- TypeScript strict mode enabled
- Functional components with hooks
- Custom hooks for data fetching
- shadcn/ui for consistent styling
- Proper error handling and loading states

---

## Next Steps (If Starting Fresh)

1. **Week 1:** Foundation
   - Set up Supabase project
   - Run database migrations (use MCP)
   - Configure Netlify Identity
   - Build auth flow

2. **Week 2:** Core Features
   - Workout logging interface
   - Progression calculations
   - Exercise history viewer

3. **Week 3:** Guardrails & Nutrition
   - Implement methodology enforcement
   - Build nutrition calculator
   - Phase rotation system

4. **Week 4:** Analytics & Deploy
   - Progress charts
   - Fitness standards
   - Deploy to Netlify
   - Test multi-device sync

---

## Final Notes

This project is a comprehensive workout tracker built with modern web technologies, designed to be completely free while providing professional-grade features. The use of Supabase MCP ensures safe and trackable database operations, while RLS guarantees data security. Always refer to the `/docs` folder for detailed specifications on features, database schema, and implementation roadmaps.

**Remember:** ALWAYS use Supabase MCP when working with the database!